<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SV-SOFT-TIENDA DE CELULARES</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="auth-styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <!-- Añadir estos enlaces en el head de tu HTML principal -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* Estilos para la factura imprimible */
    @media print {
      body * {
        visibility: hidden;
      }
      #factura-imprimible, #factura-imprimible * {
        visibility: visible;
      }
      #factura-imprimible {
        position: absolute;
        left: 0;
        top: 0;
        width: 80mm;
        padding: 5mm;
      }
    }
    
    #factura-imprimible {
      display: none;
      width: 80mm;
      margin: 0 auto;
      padding: 10px;
      border: 1px solid #ddd;
      background-color: #fff;
      font-family: Arial, sans-serif;
    }
    
    #factura-imprimible .header {
      text-align: center;
      margin-bottom: 15px;
      border-bottom: 1px dashed #ccc;
      padding-bottom: 10px;
    }
    
    #factura-imprimible .logo {
      max-width: 60mm;
      max-height: 30mm;
      margin-bottom: 10px;
    }
    
    #factura-imprimible .company-name {
      font-size: 16px;
      font-weight: bold;
      margin: 5px 0;
    }
    
    #factura-imprimible .company-info p {
      font-size: 12px;
      margin: 3px 0;
    }
    
    #factura-imprimible .customer-info {
      margin-bottom: 15px;
      font-size: 12px;
      border-bottom: 1px dashed #ccc;
      padding-bottom: 10px;
    }
    
    #factura-imprimible .customer-info h2 {
      font-size: 14px;
      margin: 5px 0;
    }
    
    #factura-imprimible .customer-info p {
      margin: 3px 0;
    }
    
    #factura-imprimible .items {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
      font-size: 12px;
    }
    
    #factura-imprimible .items th, #factura-imprimible .items td {
      border-bottom: 1px dashed #ccc;
      padding: 5px;
      text-align: left;
    }
    
    #factura-imprimible .items th {
      font-weight: bold;
    }
    
    #factura-imprimible .total {
      text-align: right;
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 15px;
      border-top: 1px dashed #ccc;
      padding-top: 10px;
    }
    
    #factura-imprimible .footer {
      text-align: center;
      font-size: 12px;
      margin-top: 20px;
      border-top: 1px dashed #ccc;
      padding-top: 10px;
    }
    
    #factura-imprimible .footer p {
      margin: 5px 0;
    }
     /* Estilos para asegurar que las pestañas se muestren correctamente */
    .tab-pane.active {
      display: block !important;
    }
    
    .tab-pane {
      display: none;
    }
    
    /* Asegurar que el modal se muestre correctamente */
    .modal.show {
      display: block;
      background-color: rgba(0,0,0,0.5);
    }
    
    /* Estilos para Firebase sync button */
    .firebase-sync-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      background-color: #4a6da7;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 15px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .firebase-sync-button:hover {
      background-color: #3a5a8f;
    }
    
    /* Estilos para Firebase status indicator */
    .firebase-status {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 12px;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 5px 10px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .firebase-status .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .firebase-status .status-indicator.online {
      background-color: #4CAF50;
    }
    
    .firebase-status .status-indicator.offline {
      background-color: #F44336;
    }

    /* Estilos para el header con información de usuario y botón salir */
    .user-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #f8f9fa;
      border-bottom: 1px solid #e9ecef;
      margin-bottom: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-role {
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 4px;
      background-color: #4a6da7;
      color: white;
    }

    .user-role.admin {
      background-color: #dc3545;
    }

    .user-role.cajero {
      background-color: #28a745;
    }

    .user-role.taller {
      background-color: #fd7e14;
    }

    .logout-button {
      padding: 8px 15px;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .logout-button:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SV-SOFT-TIENDA DE CELULARES</h1>
            <p>Control de inventario, facturación, compras y más</p>
        </header>

        <!-- Barra de usuario con rol y botón salir -->
        <div class="user-header">
            <div class="user-info">
                <span>Usuario: <strong id="nombreUsuario">Usuario</strong></span>
                <span class="user-role" id="rolUsuario">Rol</span>
            </div>
            <button class="logout-button" onclick="cerrarSesion()">
                <i class="fas fa-sign-out-alt"></i> Salir
            </button>
        </div>

        <button id="back-to-dashboard" onclick="volverAlDashboard()">
            <i class="fas fa-arrow-left"></i> Volver al Dashboard
        </button>

        <div class="dashboard">
            <div class="card" onclick="toggleSection('inventario')">
                <i class="fas fa-boxes"></i>
                <h3>Inventario</h3>
                <p>Gestión de productos</p>
            </div>
            <div class="card" onclick="toggleSection('facturacion')">
                <i class="fas fa-file-invoice-dollar"></i>
                <h3>Facturación</h3>
                <p>Emisión de facturas</p>
            </div>
            <div class="card" onclick="toggleSection('compras')">
                <i class="fas fa-shopping-cart"></i>
                <h3>Compras</h3>
                <p>Registro de compras</p>
            </div>
            <div class="card" onclick="toggleSection('cuentasCobrar')">
                <i class="fas fa-hand-holding-usd"></i>
                <h3>Cuentas por Cobrar</h3>
                <p>Facturas a crédito</p>
            </div>
            <div class="card" onclick="toggleSection('cuentasPagar')">
                <i class="fas fa-money-bill-wave"></i>
                <h3>Cuentas por Pagar</h3>
                <p>Compras a crédito</p>
            </div>
            <div class="card" onclick="toggleSection('capital')">
                <i class="fas fa-coins"></i>
                <h3>Capital</h3>
                <p>Control de capital</p>
            </div>
            <div class="card" onclick="toggleSection('ganancias')">
                <i class="fas fa-chart-line"></i>
                <h3>Ingresos/Gastos</h3>
                <p>Control de ganancias</p>
            </div>
            <div class="card" onclick="toggleSection('registros')">
                <i class="fas fa-clipboard-list"></i>
                <h3>Registros</h3>
                <p>Historial de operaciones</p>
            </div>
            <div class="card" onclick="toggleSection('taller')">
                <i class="fas fa-tools"></i>
                <h3>Taller de Reparación</h3>
                <p>Gestión de reparaciones</p>
            </div>
            <div class="card" onclick="toggleSection('clientes')">
                <i class="fas fa-users"></i>
                <h3>Clientes y Proveedores</h3>
                <p>Gestión de contactos</p>
            </div>
        </div>

        <!-- Sección de Inventario -->
        <div id="inventario" class="seccion">
            <h2>Gestión de Inventario</h2>
            <div class="controls">
                <div>
                    <button id="btnAgregarProducto" class="action-button">
                        <i class="fas fa-plus"></i> Agregar Producto
                    </button>
                    <input type="file" id="importarExcel" accept=".xlsx, .xls" onchange="importarDesdeExcel()" style="display: none;">
                    <button onclick="document.getElementById('importarExcel').click()" class="action-button">
                        <i class="fas fa-file-excel"></i> Importar desde Excel
                    </button>
                </div>
                <div>
                    <input type="text" id="buscarProducto" placeholder="Buscar producto...">
                    <select id="ordenarProductos">
                        <option value="">Ordenar por...</option>
                        <option value="alfabetico">Orden alfabético</option>
                        <option value="stock_bajo">Stock más bajo</option>
                    </select>
                </div>
            </div>

            <form id="formInventario" class="form-section">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="nombreProducto">Nombre del Producto</label>
                            <input type="text" id="nombreProducto" required>
                        </div>
                        <div class="form-group">
                            <label for="codigoProducto">Código</label>
                            <input type="text" id="codigoProducto" required>
                        </div>
                        <div class="form-group">
                            <label for="precioCompra">Precio de Compra</label>
                            <input type="number" id="precioCompra" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="precioVenta">Precio de Venta</label>
                            <input type="number" id="precioVenta" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="cantidadInventario">Cantidad en Inventario</label>
                            <input type="number" id="cantidadInventario" required>
                        </div>
                        <div class="form-group">
                            <label for="cantidadMinima">Cantidad Mínima</label>
                            <input type="number" id="cantidadMinima" required>
                        </div>
                        <div class="form-group">
                            <label for="etiquetaProducto">Etiqueta</label>
                            <input type="text" id="etiquetaProducto">
                        </div>
                        <div class="form-group">
                            <label for="ubicacionProducto">Ubicación en Almacén</label>
                            <input type="text" id="ubicacionProducto">
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <button type="submit" id="btnGuardarProducto">Agregar Producto</button>
                    <button type="button" id="btnCancelarEdicion">Cancelar</button>
                </div>
            </form>

            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Código</th>
                            <th>Precio Compra</th>
                            <th>Precio Venta</th>
                            <th>Cantidad</th>
                            <th>Mínimo</th>
                            <th>Etiqueta</th>
                            <th>Ubicación</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpoTablaInventario"></tbody>
                </table>
            </div>
        </div>

        <!-- Sección de Facturación -->
        <div id="facturacion" class="seccion">
            <h2>Facturación</h2>
            <div class="factura-container">
                <div class="factura-form">
                    <form id="formFactura" class="form-section">
                        <div class="form-group">
                            <label for="clienteFactura">Cliente</label>
                            <input type="text" id="clienteFactura" required autocomplete="off">
                            <div id="sugerenciasClientes" class="sugerencias"></div>
                        </div>
                        <div class="form-group">
                            <label for="fechaFactura">Fecha</label>
                            <input type="text" id="fechaFactura" readonly>
                        </div>
                        <div class="form-group">
                            <button type="button" id="btnBuscarReparacion" class="action-button">
                                <i class="fas fa-tools"></i> Facturar Reparación
                            </button>
                        </div>
                        <div class="form-group">
                            <label for="buscarProductoFactura">Buscar Producto</label>
                            <input type="text" id="buscarProductoFactura" placeholder="Buscar por nombre o código...">
                        </div>
                        <div class="form-group">
                            <label for="productoSeleccionado">Producto</label>
                            <select id="productoSeleccionado"></select>
                        </div>
                        <div class="form-group">
                            <label for="cantidadFactura">Cantidad</label>
                            <input type="number" id="cantidadFactura" min="1">
                        </div>
                        <div class="form-group">
                            <label for="precioFactura">Precio</label>
                            <div class="precio-editable">
                                <input type="number" id="precioFactura" step="0.01" readonly>
                                <button type="button" onclick="document.getElementById('precioFactura').readOnly = !document.getElementById('precioFactura').readOnly" class="action-button btn-edit-precio">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <button type="button" onclick="agregarProductoFactura()" class="action-button">
                                <i class="fas fa-plus"></i> Añadir Producto
                            </button>
                        </div>
                        <div class="form-group">
                            <label for="tipoFactura">Tipo de Factura</label>
                            <select id="tipoFactura">
                                <option value="contado">Contado</option>
                                <option value="credito">Crédito</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="metodoPago">Método de Pago</label>
                            <select id="metodoPago">
                                <option value="efectivo">Efectivo</option>
                                <option value="tarjeta">Tarjeta</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="factura-preview">
                    <h3>Detalle de Factura</h3>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Precio</th>
                                    <th>Subtotal</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpoTablaFactura"></tbody>
                        </table>
                    </div>
                    <div class="factura-totals">
                        <div class="form-group">
                            <label for="totalFactura">Total:</label>
                            <span id="totalFactura">0</span>
                        </div>
                        <div class="form-group">
                            <label for="pagoConFactura">Pago con:</label>
                            <input type="number" id="pagoConFactura" onchange="calcularVuelto()">
                        </div>
                        <div class="form-group">
                            <label for="vueltoFactura">Vuelto:</label>
                            <span id="vueltoFactura">0.00</span>
                        </div>
                    </div>
                    <div id="contenidoFactura" style="display: none;">
                        <!-- Aquí se generará el contenido de la factura para imprimir -->
                    </div>
                    <div class="button-group">
                        <button onclick="finalizarFactura()" class="action-button">
                            <i class="fas fa-check"></i> Finalizar Factura
                        </button>
                        <button onclick="imprimirFactura()" class="action-button">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para seleccionar reparaciones -->
        <div id="modalReparaciones" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('modalReparaciones').style.display='none'">&times;</span>
                <h2>Reparaciones Terminadas</h2>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Equipo</th>
                                <th>Detalles</th>
                                <th>Precio</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpoTablaReparacionesFacturar"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Modal para ver detalles -->
        <div id="modalDetalles" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('modalDetalles').style.display='none'">&times;</span>
                <h2 id="tituloModalDetalles">Detalles</h2>
                <div id="contenidoModalDetalles" class="modal-body">
                    <!-- Aquí se cargarán los detalles dinámicamente -->
                </div>
            </div>
        </div>

        <!-- Modal para abonar pagos -->
        <div id="modalAbonarPago" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('modalAbonarPago').style.display='none'">&times;</span>
                <h2 id="tituloModalAbonarPago">Abonar Pago</h2>
                <div class="modal-body">
                    <form id="formAbonarPago" class="form-section">
                        <div class="form-group">
                            <label for="montoAbono">Monto a abonar</label>
                            <input type="number" id="montoAbono" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="metodoPagoAbono">Método de Pago</label>
                            <select id="metodoPagoAbono">
                                <option value="efectivo">Efectivo</option>
                                <option value="tarjeta">Tarjeta</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="observacionesAbono">Observaciones</label>
                            <textarea id="observacionesAbono" rows="3"></textarea>
                        </div>
                        <input type="hidden" id="idFacturaAbono">
                        <input type="hidden" id="tipoFacturaAbono">
                        <div class="button-group">
                            <button type="submit" class="action-button">
                                <i class="fas fa-save"></i> Guardar Abono
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sección de Taller de Reparación -->
        <div id="taller" class="seccion">
            <h2>Taller de Reparación</h2>
            
            <div class="form-section">
                <h3>Ingresar Equipo a Reparar</h3>
                <form id="formReparacion">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="clienteReparacion">Nombre del Cliente</label>
                                <input type="text" id="clienteReparacion" required autocomplete="off">
                                <div id="sugerenciasClientesReparacion" class="sugerencias"></div>
                            </div>
                            <div class="form-group">
                                <label for="cedulaReparacion">Cédula de Identidad</label>
                                <input type="text" id="cedulaReparacion" required>
                            </div>
                            <div class="form-group">
                                <label for="telefonoReparacion">Número de Teléfono</label>
                                <input type="text" id="telefonoReparacion" required>
                            </div>
                            <div class="form-group">
                                <label for="equipoReparacion">Equipo</label>
                                <input type="text" id="equipoReparacion" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="detallesReparacion">Detalles de la Reparación</label>
                                <textarea id="detallesReparacion" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="piezasReparacion">Piezas Funcionales (opcional)</label>
                                <textarea id="piezasReparacion" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="precioReparacion">Precio Estimado (opcional)</label>
                                <input type="number" id="precioReparacion" step="0.01">
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="action-button">
                            <i class="fas fa-plus"></i> Añadir Reparación
                        </button>
                    </div>
                </form>
            </div>

            <div class="taller-container">
                <!-- Sección de Reparaciones Pendientes -->
                <div class="taller-section">
                    <h3>Reparaciones Pendientes</h3>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Cliente</th>
                                    <th>Teléfono</th>
                                    <th>Equipo</th>
                                    <th>Detalles</th>
                                    <th>Precio Est.</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpoTablaReparaciones"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Sección de Reparaciones En Proceso -->
                <div class="taller-section">
                    <h3>Reparaciones En Proceso</h3>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Cliente</th>
                                    <th>Teléfono</th>
                                    <th>Equipo</th>
                                    <th>Detalles</th>
                                    <th>Precio Est.</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpoTablaReparacionesEnProceso"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Sección de Reparaciones Terminadas -->
                <div class="taller-section">
                    <h3>Reparaciones Terminadas</h3>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Cliente</th>
                                    <th>Teléfono</th>
                                    <th>Equipo</th>
                                    <th>Detalles</th>
                                    <th>Precio Est.</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpoTablaReparacionesTerminadas"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de Compras -->
        <div id="compras" class="seccion">
            <h2>Registro de Compras</h2>
            <div class="compra-container">
                <div class="compra-form">
                    <form id="formCompra" class="form-section">
                        <div class="form-group">
                            <label for="proveedorCompra">Proveedor</label>
                            <input type="text" id="proveedorCompra" required autocomplete="off">
                            <div id="sugerenciasProveedores" class="sugerencias"></div>
                        </div>
                        <div class="form-group">
                            <label for="fechaCompra">Fecha</label>
                            <input type="text" id="fechaCompra" readonly>
                        </div>
                        <div class="form-group">
                            <label for="buscarProductoCompra">Buscar Producto</label>
                            <input type="text" id="buscarProductoCompra" placeholder="Buscar por nombre o código...">
                        </div>
                        <div class="form-group">
                            <label for="productoCompraSeleccionado">Producto</label>
                            <select id="productoCompraSeleccionado"></select>
                        </div>
                        <div class="form-group">
                            <label for="cantidadCompra">Cantidad</label>
                            <input type="number" id="cantidadCompra" min="1">
                        </div>
                        <div class="form-group">
                            <label for="precioCompraProducto">Precio de Compra</label>
                            <input type="number" id="precioCompraProducto" step="0.01">
                        </div>
                        <div class="form-group">
                            <button type="button" onclick="agregarProductoCompra()" class="action-button">
                                <i class="fas fa-plus"></i> Añadir Producto
                            </button>
                            <button type="button" onclick="mostrarFormNuevoProducto()" class="action-button">
                                <i class="fas fa-star"></i> Nuevo Producto
                            </button>
                        </div>
                        <div class="form-group">
                            <label for="tipoCompra">Tipo de Compra</label>
                            <select id="tipoCompra">
                                <option value="contado">Contado</option>
                                <option value="credito">Crédito</option>
                            </select>
                        </div>
                    </form>

                    <form id="formNuevoProductoCompra" class="nested-form" style="display: none;">
                        <h4>Nuevo Producto</h4>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="nombreNuevoProducto">Nombre</label>
                                    <input type="text" id="nombreNuevoProducto" required>
                                </div>
                                <div class="form-group">
                                    <label for="codigoNuevoProducto">Código</label>
                                    <input type="text" id="codigoNuevoProducto" required>
                                </div>
                                <div class="form-group">
                                    <label for="precioCompraNuevoProducto">Precio de Compra</label>
                                    <input type="number" id="precioCompraNuevoProducto" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="precioVentaNuevoProducto">Precio de Venta</label>
                                    <input type="number" id="precioVentaNuevoProducto" step="0.01" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="cantidadNuevoProducto">Cantidad</label>
                                    <input type="number" id="cantidadNuevoProducto" required>
                                </div>
                                <div class="form-group">
                                    <label for="cantidadMinimaNuevoProducto">Cantidad Mínima</label>
                                    <input type="number" id="cantidadMinimaNuevoProducto" required>
                                </div>
                                <div class="form-group">
                                    <label for="etiquetaNuevoProducto">Etiqueta</label>
                                    <input type="text" id="etiquetaNuevoProducto">
                                </div>
                                <div class="form-group">
                                    <label for="ubicacionNuevoProducto">Ubicación en Almacén</label>
                                    <input type="text" id="ubicacionNuevoProducto">
                                </div>
                            </div>
                        </div>
                        <div class="button-group">
                            <button type="button" onclick="agregarNuevoProductoCompra()" class="action-button">
                                <i class="fas fa-plus"></i> Agregar a la Compra
                            </button>
                            <button type="button" onclick="document.getElementById('formNuevoProductoCompra').style.display='none'" class="action-button">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </form>
                </div>
                <div class="compra-preview">
                    <h3>Detalle de Compra</h3>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Precio</th>
                                    <th>Subtotal</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpoTablaCompra"></tbody>
                        </table>
                    </div>
                    <div class="factura-totals">
                        <div class="form-group">
                            <label for="totalCompra">Total:</label>
                            <span id="totalCompra">0</span>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" form="formCompra" class="action-button">
                            <i class="fas fa-check"></i> Finalizar Compra
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de Cuentas por Cobrar -->
        <div id="cuentasCobrar" class="seccion">
            <h2>Cuentas por Cobrar</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Cliente</th>
                            <th>Total</th>
                            <th>Saldo Pendiente</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpoTablaCuentasCobrar"></tbody>
                </table>
            </div>
        </div>

        <!-- Sección de Cuentas por Pagar -->
        <div id="cuentasPagar" class="seccion">
            <h2>Cuentas por Pagar</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Proveedor</th>
                            <th>Total</th>
                            <th>Saldo Pendiente</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpoTablaCuentasPagar"></tbody>
                </table>
            </div>
        </div>

        <!-- Sección de Capital -->
        <div id="capital" class="seccion">
            <h2>Control de Capital</h2>
            <div class="capital-container">
                <div class="capital-info">
                    <h3>Capital Actual</h3>
                    <div class="form-group">
                        <label>Capital en Productos:</label>
                        <div class="capital-value" id="capitalProductos">0.00</div>
                    </div>
                    <div class="form-group">
                        <label>Capital en Efectivo:</label>
                        <div class="capital-value" id="capitalEfectivo">0.00</div>
                    </div>
                    <div class="form-group">
                        <label>Capital en Banco:</label>
                        <div class="capital-value" id="capitalBanco">0.00</div>
                    </div>
                    <div class="form-group">
                        <label>Capital Total:</label>
                        <div class="capital-value" id="capitalTotal">0.00</div>
                    </div>
                </div>
                <div class="capital-form">
                    <h3>Añadir Capital</h3>
                    <form id="formCapital" class="form-section">
                        <div class="form-group">
                            <label for="montoCapital">Monto a Añadir (Efectivo)</label>
                            <input type="number" id="montoCapital" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="descripcionCapital">Descripción</label>
                            <input type="text" id="descripcionCapital" required>
                        </div>
                        <div class="button-group">
                            <button type="submit" class="action-button">
                                <i class="fas fa-plus"></i> Añadir al Capital
                            </button>
                        </div>
                    </form>

                    <h3>Añadir Capital en Banco</h3>
                    <div class="form-section">
                        <div class="form-group">
                            <label for="montoBanco">Monto a Añadir (Banco)</label>
                            <input type="number" id="montoBanco" step="0.01" required>
                        </div>
                        <div class="button-group">
                            <button id="btnAnadirBanco" class="action-button">
                                <i class="fas fa-plus"></i> Añadir al Banco
                            </button>
                        </div>
                    </div>

                    <h3>Añadir Ganancias al Capital</h3>
                    <div class="form-section">
                        <div class="form-group">
                            <label for="montoGananciasCapital">Monto de Ganancias a Añadir</label>
                            <input type="number" id="montoGananciasCapital" step="0.01" required>
                        </div>
                        <div class="button-group">
                            <button type="button" onclick="anadirGananciasCapital()" class="action-button">
                                <i class="fas fa-plus"></i> Añadir Ganancias al Capital
                            </button>
                        </div>
                    </div>

                    <h3>Restar Capital</h3>
                    <div class="form-section">
                        <div class="form-group">
                            <label for="montoRestarCapital">Monto a Restar</label>
                            <input type="number" id="montoRestarCapital" step="0.01" required>
                        </div>
                        <div class="button-group">
                            <button type="button" onclick="restarCapital()" class="action-button">
                                <i class="fas fa-minus"></i> Restar del Capital
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de Ganancias -->
        <div id="ganancias" class="seccion">
            <h2>Control de Ingresos y Gastos</h2>
            <div class="ganancias-container">
                <div class="ganancias-info">
                    <h3>Ganancias Actuales</h3>
                    <div class="form-group">
                        <label>Ganancias Totales:</label>
                        <div class="ganancias-value" id="gananciasTotal">0.00</div>
                    </div>
                    <h3>Buscar Ganancias por Período</h3>
                    <div class="form-section">
                        <div class="form-group">
                            <label for="fechaInicioGanancias">Fecha Inicio</label>
                            <input type="date" id="fechaInicioGanancias">
                        </div>
                        <div class="form-group">
                            <label for="fechaFinGanancias">Fecha Fin</label>
                            <input type="date" id="fechaFinGanancias">
                        </div>
                        <div class="button-group">
                            <button type="button" onclick="buscarGananciasPorFecha()" class="action-button">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>
                        <div class="form-group mt-20">
                            <label>Ganancias en el período seleccionado:</label>
                            <div class="ganancias-value" id="gananciasEnPeriodo">0.00</div>
                        </div>
                    </div>
                </div>
                <div class="ganancias-form">
                    <h3>Registrar Ingreso/Gasto</h3>
                    <form id="formIngresoGasto" class="form-section">
                        <div class="form-group">
                            <label for="tipoMovimiento">Tipo</label>
                            <select id="tipoMovimiento">
                                <option value="ingreso">Ingreso</option>
                                <option value="gasto">Gasto</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="montoMovimiento">Monto</label>
                            <input type="number" id="montoMovimiento" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="descripcionMovimiento">Descripción</label>
                            <input type="text" id="descripcionMovimiento" required>
                        </div>
                        <div class="form-group">
                            <label for="etiquetaMovimiento">Etiqueta</label>
                            <input type="text" id="etiquetaMovimiento">
                        </div>
                        <div class="button-group">
                            <button type="submit" class="action-button">
                                <i class="fas fa-save"></i> Registrar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sección de Registros -->
        <div id="registros" class="seccion">
            <h2>Registros</h2>
            <div class="registros-controls">
                <div>
                    <select id="tipoRegistro">
                        <option value="facturas">Facturas</option>
                        <option value="ingresos">Ingresos</option>
                        <option value="gastos">Gastos</option>
                        <option value="compras">Compras</option>
                    </select>
                </div>
                <div>
                    <input type="text" id="buscarRegistro" placeholder="Buscar...">
                </div>
            </div>
            <div class="table-responsive">
                <table>
                    <thead id="encabezadoRegistros"></thead>
                    <tbody id="cuerpoTablaRegistros"></tbody>
                </table>
            </div>
        </div>

        <!-- Sección de Clientes y Proveedores -->
        <div id="clientes" class="seccion">
            <h2>Gestión de Clientes y Proveedores</h2>
            
            <div class="tabs">
                <button class="tab-button active" onclick="cambiarTab('tabClientes')">Clientes</button>
                <button class="tab-button" onclick="cambiarTab('tabProveedores')">Proveedores</button>
            </div>
            
            <div id="tabClientes" class="tab-content active">
                <div class="controls">
                    <div>
                        <button id="btnAgregarCliente" class="action-button">
                            <i class="fas fa-plus"></i> Agregar Cliente
                        </button>
                    </div>
                    <div>
                        <input type="text" id="buscarCliente" placeholder="Buscar cliente...">
                    </div>
                </div>
                
                <form id="formCliente" class="form-section" style="display: none;">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="nombreCliente">Nombre</label>
                                <input type="text" id="nombreCliente" required>
                            </div>
                            <div class="form-group">
                                <label for="cedulaCliente">Cédula</label>
                                <input type="text" id="cedulaCliente" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="telefonoCliente">Número de Teléfono</label>
                                <input type="text" id="telefonoCliente" required>
                            </div>
                            <div class="form-group">
                                <label for="direccionCliente">Dirección (opcional)</label>
                                <input type="text" id="direccionCliente">
                            </div>
                            <div class="form-group">
                                <label for="correoCliente">Correo (opcional)</label>
                                <input type="email" id="correoCliente">
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" id="btnGuardarCliente">Agregar Cliente</button>
                        <button type="button" id="btnCancelarCliente" onclick="document.getElementById('formCliente').style.display='none'">Cancelar</button>
                    </div>
                </form>
                
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Nombre</th>
                                <th>Cédula</th>
                                <th>Teléfono</th>
                                <th>Dirección</th>
                                <th>Correo</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpoTablaClientes"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="tabProveedores" class="tab-content">
                <div class="controls">
                    <div>
                        <button id="btnAgregarProveedor" class="action-button">
                            <i class="fas fa-plus"></i> Agregar Proveedor
                        </button>
                    </div>
                    <div>
                        <input type="text" id="buscarProveedor" placeholder="Buscar proveedor...">
                    </div>
                </div>
                
                <form id="formProveedor" class="form-section" style="display: none;">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="nombreProveedor">Nombre</label>
                                <input type="text" id="nombreProveedor" required>
                            </div>
                            <div class="form-group">
                                <label for="telefonoProveedor">Número de Teléfono</label>
                                <input type="text" id="telefonoProveedor" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="direccionProveedor">Dirección</label>
                                <input type="text" id="direccionProveedor" required>
                            </div>
                            <div class="form-group">
                                <label for="contactoProveedor">Persona de Contacto (opcional)</label>
                                <input type="text" id="contactoProveedor">
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" id="btnGuardarProveedor">Agregar Proveedor</button>
                        <button type="button" id="btnCancelarProveedor" onclick="document.getElementById('formProveedor').style.display='none'">Cancelar</button>
                    </div>
                </form>
                
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Nombre</th>
                                <th>Teléfono</th>
                                <th>Dirección</th>
                                <th>Contacto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpoTablaProveedores"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Añadir el div para la factura imprimible -->
    <div id="factura-imprimible">
        <div class="header">
            <img id="logoEmpresa-print" src="/placeholder.svg" alt="Logo de la empresa" class="logo">
            <div class="company-info">
                <h1 id="nombreEmpresa-print" class="company-name">Nombre de la Empresa</h1>
                <p id="direccionEmpresa-print">Dirección de la Empresa</p>
                <p id="telefonoEmpresa-print">Teléfono: No disponible</p>
                <p>Código de Factura: <span id="codigoFactura-print"></span></p>
                <p>Fecha: <span id="fechaFactura-print"></span></p>
            </div>
        </div>
        
        <div class="customer-info">
            <h2>Datos del Cliente</h2>
            <p>Nombre: <span id="nombreCliente-print"></span></p>
            <p>Dirección: <span id="direccionCliente-print">No disponible</span></p>
            <p>Teléfono: <span id="telefonoCliente-print">No disponible</span></p>
        </div>
        
        <table class="items">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cant.</th>
                    <th>Precio</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="tablaProductos-print">
                <!-- Productos se cargarán dinámicamente -->
            </tbody>
        </table>
        
        <div class="total">
            Total Final: <span id="totalFinal-print">0.00</span>
        </div>
        
        <div class="footer">
            <p>¡Gracias por su compra!</p>
            <p>No se aceptan devoluciones sin su factura</p>
        </div>
    </div>
  </div>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics-compat.js"></script>
   
    <!-- Tu script original -->
    <script src="script.js"></script>
    
    <!-- Script de optimización de Firebase (debe ser type="module") -->
    <script type="module" src="firebase-optimization.js"></script>
    
    <!-- Script para inicializar las secciones faltantes -->
    <script>
    // Este script se encarga de inicializar las secciones de capital, ingresos/gastos y registros
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Inicializando secciones específicas...");
        
        // Mostrar información del usuario actual
        function mostrarInfoUsuario() {
            // Obtener información del usuario desde sessionStorage o localStorage
            const usuarioActual = JSON.parse(sessionStorage.getItem('currentUser') || localStorage.getItem('persistentUser') || '{}');
            
            if (usuarioActual && usuarioActual.nombre) {
                document.getElementById('nombreUsuario').textContent = usuarioActual.nombre;
                
                // Mostrar el rol del usuario
                const rolElement = document.getElementById('rolUsuario');
                if (rolElement) {
                    let rolTexto = 'Usuario';
                    let rolClase = '';
                    
                    if (usuarioActual.rol === 'admin') {
                        rolTexto = 'Administrador';
                        rolClase = 'admin';
                    } else if (usuarioActual.rol === 'cajero') {
                        rolTexto = 'Cajero';
                        rolClase = 'cajero';
                    } else if (usuarioActual.rol === 'taller') {
                        rolTexto = 'Técnico de Taller';
                        rolClase = 'taller';
                    }
                    
                    rolElement.textContent = rolTexto;
                    rolElement.className = 'user-role ' + rolClase;
                }
            }
        }
        
        // Función para inicializar la sección de Capital
        async function inicializarSeccionCapital() {
            console.log("Inicializando sección de Capital...");
            
            try {
                // Cargar datos de capital
                let datosCapital = [];
                
                if (window.cargarCapitalConsolidado) {
                    // Usar la función optimizada
                    datosCapital = await window.cargarCapitalConsolidado();
                } else if (window.cargarCapital) {
                    // Usar la función original
                    datosCapital = await window.cargarCapital();
                }
                
                console.log("Datos de capital cargados:", datosCapital);
                
                // Actualizar la UI con los datos cargados
                if (datosCapital && datosCapital.length > 0) {
                    // Calcular totales
                    let totalEfectivo = 0;
                    let totalBanco = 0;
                    
                    datosCapital.forEach(item => {
                        if (item.tipo === 'efectivo') {
                            totalEfectivo += parseFloat(item.monto || 0);
                        } else if (item.tipo === 'banco') {
                            totalBanco += parseFloat(item.monto || 0);
                        }
                    });
                    
                    // Actualizar valores en la UI
                    document.getElementById('capitalEfectivo').textContent = totalEfectivo.toFixed(2);
                    document.getElementById('capitalBanco').textContent = totalBanco.toFixed(2);
                    
                    // Calcular capital en productos
                    let capitalProductos = 0;
                    const productos = await window.cargarInventarioConsolidado();
                    if (productos && productos.length > 0) {
                        productos.forEach(producto => {
                            capitalProductos += parseFloat(producto.precioCompra || 0) * parseInt(producto.cantidadInventario || 0);
                        });
                    }
                    
                    document.getElementById('capitalProductos').textContent = capitalProductos.toFixed(2);
                    
                    // Calcular capital total
                    const capitalTotal = totalEfectivo + totalBanco + capitalProductos;
                    document.getElementById('capitalTotal').textContent = capitalTotal.toFixed(2);
                }
                
                console.log("Sección de capital inicializada correctamente");
            } catch (error) {
                console.error("Error al inicializar sección de capital:", error);
            }
        }
        
        // Función para inicializar la sección de Ingresos y Gastos
        async function inicializarSeccionIngresosGastos() {
            console.log("Inicializando sección de Ingresos y Gastos...");
            
            try {
                // Cargar datos de ingresos y gastos
                let ingresos = [];
                let gastos = [];
                
                if (window.cargarIngresosGastosConsolidados) {
                    // Usar función optimizada
                    const movimientos = await window.cargarIngresosGastosConsolidados();
                    ingresos = movimientos.filter(m => m.tipo === "ingreso");
                    gastos = movimientos.filter(m => m.tipo === "gasto");
                } else {
                    // Usar funciones originales
                    if (window.cargarIngresos) {
                        ingresos = await window.cargarIngresos();
                    }
                    if (window.cargarGastos) {
                        gastos = await window.cargarGastos();
                    }
                }
                
                console.log("Ingresos cargados:", ingresos);
                console.log("Gastos cargados:", gastos);
                
                // Calcular ganancias totales
                let totalIngresos = 0;
                let totalGastos = 0;
                
                if (ingresos && ingresos.length > 0) {
                    ingresos.forEach(ingreso => {
                        totalIngresos += parseFloat(ingreso.monto || 0);
                    });
                }
                
                if (gastos && gastos.length > 0) {
                    gastos.forEach(gasto => {
                        totalGastos += parseFloat(gasto.monto || 0);
                    });
                }
                
                const gananciasTotal = totalIngresos - totalGastos;
                document.getElementById('gananciasTotal').textContent = gananciasTotal.toFixed(2);
                
                console.log("Sección de ingresos y gastos inicializada correctamente");
            } catch (error) {
                console.error("Error al inicializar sección de ingresos y gastos:", error);
            }
        }
        
        // Función para inicializar la sección de Registros
        async function inicializarSeccionRegistros() {
            console.log("Inicializando sección de Registros...");
            
            try {
                // Obtener el tipo de registro seleccionado
                const tipoRegistro = document.getElementById('tipoRegistro').value || 'facturas';
                
                // Cargar registros según el tipo
                let registros = [];
                
                if (window.cargarRegistrosConsolidados) {
                    // Usar función optimizada
                    registros = await window.cargarRegistrosConsolidados(tipoRegistro);
                } else if (window.cargarRegistros) {
                    // Usar función original
                    registros = await window.cargarRegistros(tipoRegistro);
                }
                
                console.log(`Registros de tipo ${tipoRegistro} cargados:`, registros);
                
                // Configurar encabezados según el tipo
                const encabezadoRegistros = document.getElementById('encabezadoRegistros');
                const cuerpoTablaRegistros = document.getElementById('cuerpoTablaRegistros');
                
                if (encabezadoRegistros && cuerpoTablaRegistros) {
                    // Limpiar contenido actual
                    encabezadoRegistros.innerHTML = '';
                    cuerpoTablaRegistros.innerHTML = '';
                    
                    // Crear encabezados según el tipo
                    const tr = document.createElement('tr');
                    
                    if (tipoRegistro === 'facturas') {
                        tr.innerHTML = `
                            <th>Fecha</th>
                            <th>Cliente</th>
                            <th>Total</th>
                            <th>Tipo</th>
                            <th>Acciones</th>
                        `;
                    } else if (tipoRegistro === 'compras') {
                        tr.innerHTML = `
                            <th>Fecha</th>
                            <th>Proveedor</th>
                            <th>Total</th>
                            <th>Tipo</th>
                            <th>Acciones</th>
                        `;
                    } else if (tipoRegistro === 'ingresos' || tipoRegistro === 'gastos') {
                        tr.innerHTML = `
                            <th>Fecha</th>
                            <th>Descripción</th>
                            <th>Monto</th>
                            <th>Etiqueta</th>
                            <th>Acciones</th>
                        `;
                    }
                    
                    encabezadoRegistros.appendChild(tr);
                    
                    // Llenar tabla con los registros
                    if (registros && registros.length > 0) {
                        registros.forEach((registro, index) => {
                            const fila = document.createElement('tr');
                            
                            if (tipoRegistro === 'facturas') {
                                fila.innerHTML = `
                                    <td>${registro.fecha || ''}</td>
                                    <td>${registro.cliente || ''}</td>
                                    <td>${parseFloat(registro.total || 0).toFixed(2)}</td>
                                    <td>${registro.tipo || ''}</td>
                                    <td>
                                        <button onclick="verDetallesRegistro('${tipoRegistro}', ${index})" class="view-btn">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                `;
                            } else if (tipoRegistro === 'compras') {
                                fila.innerHTML = `
                                    <td>${registro.fecha || ''}</td>
                                    <td>${registro.proveedor || ''}</td>
                                    <td>${parseFloat(registro.total || 0).toFixed(2)}</td>
                                    <td>${registro.tipo || ''}</td>
                                    <td>
                                        <button onclick="verDetallesRegistro('${tipoRegistro}', ${index})" class="view-btn">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                `;
                            } else if (tipoRegistro === 'ingresos' || tipoRegistro === 'gastos') {
                                fila.innerHTML = `
                                    <td>${registro.fecha || ''}</td>
                                    <td>${registro.descripcion || ''}</td>
                                    <td>${parseFloat(registro.monto || 0).toFixed(2)}</td>
                                    <td>${registro.etiqueta || ''}</td>
                                    <td>
                                        <button onclick="verDetallesRegistro('${tipoRegistro}', ${index})" class="view-btn">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                `;
                            }
                            
                            cuerpoTablaRegistros.appendChild(fila);
                        });
                    } else {
                        // Si no hay registros, mostrar mensaje
                        const fila = document.createElement('tr');
                        fila.innerHTML = `<td colspan="5" class="text-center">No hay registros de ${tipoRegistro}</td>`;
                        cuerpoTablaRegistros.appendChild(fila);
                    }
                }
                
                console.log("Sección de registros inicializada correctamente");
            } catch (error) {
                console.error("Error al inicializar sección de registros:", error);
            }
        }
        
        // Función principal para inicializar todas las secciones
        async function inicializarSecciones() {
            console.log("Inicializando todas las secciones...");
            
            // Inicializar sección de Capital
            await inicializarSeccionCapital();
            
            // Inicializar sección de Ingresos y Gastos
            await inicializarSeccionIngresosGastos();
            
            // Inicializar sección de Registros
            await inicializarSeccionRegistros();
            
            console.log("Todas las secciones inicializadas correctamente");
        }
        
        // Añadir listeners para cambios de sección
        function agregarListenersSeccion() {
            // Listener para cambio de tipo de registro
            const tipoRegistroSelect = document.getElementById('tipoRegistro');
            if (tipoRegistroSelect) {
                tipoRegistroSelect.addEventListener('change', inicializarSeccionRegistros);
            }
            
            // Listeners para los botones de sección en el dashboard
            const botonesSeccion = document.querySelectorAll('.card');
            botonesSeccion.forEach(boton => {
                boton.addEventListener('click', function() {
                    const seccion = this.getAttribute('onclick').match(/'([^']+)'/)[1];
                    
                    // Inicializar la sección correspondiente cuando se haga clic
                    if (seccion === 'capital') {
                        inicializarSeccionCapital();
                    } else if (seccion === 'ganancias') {
                        inicializarSeccionIngresosGastos();
                    } else if (seccion === 'registros') {
                        inicializarSeccionRegistros();
                    }
                });
            });
        }
        
        // Exportar funciones para uso global
        window.inicializarSeccionCapital = inicializarSeccionCapital;
        window.inicializarSeccionIngresosGastos = inicializarSeccionIngresosGastos;
        window.inicializarSeccionRegistros = inicializarSeccionRegistros;
        window.inicializarSecciones = inicializarSecciones;
        
        // Función para ver detalles de un registro
        window.verDetallesRegistro = function(tipo, index) {
            console.log(`Ver detalles de ${tipo} en índice ${index}`);
            
            // Implementar la lógica para mostrar detalles
            // Esta función puede ser expandida según tus necesidades
        };
        
        // Mostrar información del usuario al cargar la página
        mostrarInfoUsuario();
        
        // Verificar si las funciones de optimización están disponibles
        if (window.inicializarDatosConsolidados) {
            window.inicializarDatosConsolidados().then(() => {
                console.log("Datos consolidados inicializados correctamente");
                
                // Inicializar secciones específicas
                inicializarSecciones();
                
                // Agregar listeners para cambios de sección
                agregarListenersSeccion();
            });
        } else {
            console.log("Función inicializarDatosConsolidados no disponible, inicializando secciones directamente");
            
            // Inicializar secciones específicas
            inicializarSecciones();
            
            // Agregar listeners para cambios de sección
            agregarListenersSeccion();
        }
    });
    </script>
    <!-- Añadir estos scripts al final del body en index.html -->
    <script type="module" src="firebase-optimization-enhanced.js"></script>
    <script src="session-persistence-enhanced.js"></script>
    <script src="index-script.js"></script>
</body>
</html>

